rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // ユーザーデータへのアクセス制御
    match /users/{userId} {
      // ユーザー自身のドキュメントは読み書き可能
      allow read, write: if request.auth != null && request.auth.uid == userId;

      // タスクコレクション
      match /tasks/{taskId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // カスタム単元コレクション
      match /customUnits/{unitId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // 過去問セッションコレクション
      match /pastPaperSessions/{sessionId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // テスト成績コレクション
      match /testScores/{scoreId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // 志望校詳細コレクション
      match /targetSchoolsDetail/{schoolId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // PDFドキュメントコレクション
      match /pdfDocuments/{pdfId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // PDF問題記録コレクション
      match /pdfProblems/{problemId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // SAPIXテキストコレクション
      match /sapixTexts/{textId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }

    // その他のすべてのドキュメントへのアクセスを拒否
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
